

## Оптимизация изображений

Чтобы оптимизировать изображения, выполните следующие шаги:
1) Вставить на место картинки вот такой блок кода https://github.com/CodeStitchOfficial/eleventy-plugin-sharp-images?tab=readme-ov-file#vscode-snippet

2) Проставить в объект `resize` разрешение изображения для разных экранов. Общее правило для этого следующее. Оптимальное разрешение это отображаемые размеры блока умноженные на 2. Например если на сайте картинка отображается в блоке 200 на 300 пикселей, то разрешение должно быть 400 на 600 пикселей.

3) Проставить атрибут `loading="lazy"` если изображение не находится в шапке сайта. 

4) Если изображение важно показать мгновенно (обычно это изображения в шапке) то нужно добавить на страницу такую строчку: `<link rel="preload" as="image" href="landing-m.webp')}}">`

> ВАЖНО: мы не используем CSS свойство background-image для создания фоновых изображений. Причина в том что к нему нельзя применить вышеперечисленные оптимизации. Фоновые изображения нужно реализовывать через HTML атрибуты.

Вручную прописывать все эти свойства довольно утомительно. К счастью есть плагин, который поможет сделать это автоматически.

Этот плагин можно запустить через команду:
```
npx run-sharp-automation
```

> ВАЖНО: перед запуском команды нужно убедиться что запущен локальный сервер (npm run start). Это необходимо поскольку run-sharp-automation производит расчеты размеров изображений и их позицию в реальном времени в браузере через инструмент end-to-end тестирования Playwright.

Этот плагин:
- устанавливает оптимальные размеры изображений для всех экранов
- атрибут `loading="lazy"` если изображение не находится в шапке
- указывает нужно ли добавить изображение в preloading

После запуска run-sharp-automation в корне проекта появится папка image-optimizations. В этой папке будут находиться сгенерированные `<picture>` теги для всех изображений для всех страниц. Их нужно вставить вручную после чего удалить папку image-optimizations.

> Можно сгенерировать изображения только для одной страницы: `npx run-sharp-automation --target blog`

Документация генератора: https://github.com/onkyoh/codestitch-sharp-image-automation